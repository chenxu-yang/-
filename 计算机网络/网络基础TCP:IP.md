# 网络基础TCP/IP

协议protocol：计算机与网络设备要互相通信，双方就必须基于相同的方法。所有的一切都需要一种规则。

协议中存在各式各样的内容。从电缆的规格到IP地址的选定方法、寻找异地哦用户的方法、双方建立通信的顺序，以及web页面显示需要处理的步骤。

像这样把与互联网相关联的协议集合总称为TCP/IP。

## TCP/IP分层管理

TCP/IP按层次分为：应用层，传输层，网络层，数据链路层

问什么要分层：把各层之间的接口部分规划好之后，每个层次内部的设计就能够自由改动了

* 应用层：应用层决定了向用户提供应用服务时通信的活动

  TCP/IP协议族里预存了各类通用的应用服务。比如FTP（文件传输协议）和DNS（域名系统）和HTTP协议。

* 传输层：提供处于网络连接中的两台计算机之间的数据传输

  包含TCP（传输控制协议）和UDP（用户数据报协议）

* 网络层：用来处理在网络上流动的数据包。数据包是网络传输的最小数据单位。该层规定了通过怎样的路径到达对方计算机，并把数据包传送给对方。与对方计算机之间通过多台计算机或网络设备进行传输时，网络层所起的作用就是在众多的选项中选择一条传输路线。

* 链路层：用来处理连接网络的硬件部分。

![IMG_04F38CD1F5BC-1](/Users/chenxu/Downloads/IMG_04F38CD1F5BC-1.jpeg)

利用 TCP/IP 协议族进行网络通信时，会通过分层顺序与对方进行通 信。发送端从应用层往下走，接收端则往应用层往上走。
我们用 HTTP 举例来说明，首先作为发送端的客户端在应用层 (HTTP协议)发出一个想看某个Web页面的HTTP请求。
接着，为了传输方便，在传输层(TCP 协议)把从应用层处收到的数 据(HTTP 请求报文)进行分割，并在各个报文上打上标记序号及端 口号后转发给网络层。
在网络层(IP 协议)，增加作为通信目的地的 MAC 地址后转发给链 路层。这样一来，发往网络的通信请求就准备齐全了。
接收端的服务器在链路层接收到数据，按序往上层发送，一直到应用 层。当传输到应用层，才能算真正接收到由客户端发送过来的 HTTP 请求。

![IMG_DF34A4483AEE-1](/Users/chenxu/Downloads/IMG_DF34A4483AEE-1.jpeg)

发送端在层与层之间传输数据时，每经过一层时必定会被打上一个该 层所属的首部信息。反之，接收端在层与层传输数据时，每经过一层 时会把对应的首部消去。
这种把数据信息包装起来的做法称为封装(encapsulate)





## 与HTTP关系密切的协议：IP、TCP和DNS

### 负责传输的IP协议

***

IP协议的作用是把各种数据包传送给对方，而要保证确实传送到对方 那里，则需要满足各类条件。其中两个重要的条件是 IP 地址和 MAC 地址(Media Access Control Address)。
IP 地址指明了节点被分配到的地址，MAC 地址是指网卡所属的固定 地址。IP 地址可以和 MAC 地址进行配对。IP 地址可变换，但 MAC 地址基本上不会更改。

IP 间的通信依赖 MAC 地址。在网络上，通信的双方在同一局域网 (LAN)内的情况是很少的，通常是经过多台计算机和网络设备中转 才能连接到对方。而在进行中转时，会利用下一站中转设备的 MAC 地址来搜索下一个中转目标。这时，会采用 ARP 协议(Address Resolution Protocol)。ARP 是一种用以解析地址的协议，根据通信方 的 IP 地址就可以反查出对应的 MAC 地址。

### 确保可靠性的TCP协议

***

TCP位于传输层，提供可靠的字节流服务。

所谓的字节流服务(Byte Stream Service)是指，为了方便传输，将大 块数据分割成以报文段(segment)为单位的数据包进行管理。而可 靠的传输服务是指，能够把数据准确可靠地传给对方。一言以蔽之， TCP 协议为了更容易传送大数据才把数据分割，而且 TCP 协议能够 确认数据最终是否送达到对方。

为了准确无误地将数据送达目标处，TCP 协议采用了三次握手 (three-way handshaking)策略。用 TCP 协议把数据包送出去后，TCP 不会对传送后的情况置之不理，它一定会向对方确认是否成功送达。握手过程中使用了 TCP 的标志(flag) —— SYN(synchronize) 和 ACK(acknowledgement)。
发送端首先发送一个带 SYN 标志的数据包给对方。接收端收到后， 回传一个带有 SYN/ACK 标志的数据包以示传达确认信息。最后，发 送端再回传一个带 ACK 标志的数据包，代表“握手”结束。
若在握手过程中某个阶段莫名中断，TCP 协议会再次以相同的顺序发 送相同的数据包。

### 负责域名解析的DNS服务

***

DNS(Domain Name System)服务是和 HTTP 协议一样位于应用层的协议。它提供域名到 IP 地址之间的解析服务。

DNS 协议提供通过域名 查找 IP 地址，或逆向从 IP 地址反查域名的服务。



### 各种协议与HTTP协议的关系

***

![IMG_65FCA5B8BC37-1](/Users/chenxu/Downloads/IMG_65FCA5B8BC37-1.jpeg)

